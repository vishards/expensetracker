<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Travel Expense Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">

<!-- Start Trip Button -->
<button onclick="openModal('startTripModal')" class="bg-green-600 text-white px-4 py-2 rounded">Start Trip</button>
<button onclick="openModal('endTripModal')" class="bg-red-600 text-white px-4 py-2 rounded">End Trip</button>

<!-- Section 1: Fuel Entry -->
<div class="mt-4 bg-white p-4 rounded shadow">
  <h2 class="text-lg font-bold mb-2">Fuel Entry</h2>
  <div class="flex gap-2 mb-2">
    <input id="fuelOdo" type="number" placeholder="Odometer (km)" class="flex-1 border p-2 rounded" />
    <input id="fuelLiters" type="number" placeholder="Liters" class="flex-1 border p-2 rounded" />
    <input id="fuelPrice" type="number" placeholder="₹/Liter" class="flex-1 border p-2 rounded" />
    <button onclick="addFuelEntry()" class="bg-blue-600 text-white px-3 py-2 rounded">Add</button>
  </div>
</div>

<!-- Section 2: Misc Expenses -->
<div class="mt-4 bg-white p-4 rounded shadow">
  <h2 class="text-lg font-bold mb-2">Misc Expense</h2>
  <div class="flex gap-2 mb-2">
    <select id="miscCategory" class="border p-2 rounded">
      <option>Food</option>
      <option>Parking</option>
      <option>Toll</option>
      <option>Misc</option>
      <option>Accommodation</option>
    </select>
    <input id="miscAmount" type="number" placeholder="Amount (₹)" class="flex-1 border p-2 rounded" />
    <button onclick="addMiscEntry()" class="bg-blue-600 text-white px-3 py-2 rounded">Add</button>
  </div>
</div>

<!-- Log Section -->
<div class="mt-4 bg-white p-4 rounded shadow">
  <h2 class="text-lg font-bold mb-2">Log</h2>
  <ul id="logList" class="space-y-1 text-sm"></ul>
</div>

<!-- Summary Section -->
<div id="summarySection" class="mt-4 bg-white p-4 rounded shadow hidden"></div>

<!-- Start Trip Modal -->
<div id="startTripModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-4 rounded shadow max-w-sm w-full">
    <h2 class="text-lg font-bold mb-2">Start New Trip</h2>
    <input id="startOdo" type="number" placeholder="Initial Odometer (km)" class="w-full border p-2 rounded mb-2" />
    <input id="startBars" type="number" placeholder="Fuel Bars (0–10)" class="w-full border p-2 rounded mb-2" />
    <div class="flex justify-end gap-2">
      <button onclick="closeModal('startTripModal')" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
      <button onclick="startTrip()" class="px-4 py-2 bg-green-600 text-white rounded">Start</button>
    </div>
  </div>
</div>

<!-- End Trip Modal -->
<div id="endTripModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white p-4 rounded shadow max-w-sm w-full">
    <h2 class="text-lg font-bold mb-2">End Trip</h2>
    <input id="endOdo" type="number" placeholder="Final Odometer (km)" class="w-full border p-2 rounded mb-2" />
    <input id="endBars" type="number" placeholder="Fuel Bars (0–10)" class="w-full border p-2 rounded mb-2" />
    <div class="flex justify-end gap-2">
      <button onclick="closeModal('endTripModal')" class="px-4 py-2 bg-gray-300 rounded">Cancel</button>
      <button onclick="endTrip()" class="px-4 py-2 bg-red-600 text-white rounded">End</button>
    </div>
  </div>
</div>

<script>
let tripData = JSON.parse(localStorage.getItem("tripData")) || null;
renderLog();

function openModal(id) {
  document.getElementById(id).classList.remove("hidden");
}
function closeModal(id) {
  document.getElementById(id).classList.add("hidden");
}

function startTrip() {
  const startOdo = parseFloat(document.getElementById("startOdo").value);
  const startBars = parseInt(document.getElementById("startBars").value);
  if (isNaN(startOdo) || isNaN(startBars) || startBars < 0 || startBars > 10) {
    alert("Enter valid starting values");
    return;
  }
  tripData = { startOdo, startBars, fuelEntries: [], miscEntries: [], endOdo: null, endBars: null };
  localStorage.setItem("tripData", JSON.stringify(tripData));
  document.getElementById("summarySection").innerHTML = "";
  document.getElementById("summarySection").classList.add("hidden");
  closeModal("startTripModal");
  renderLog();
}

function endTrip() {
  const endOdo = parseFloat(document.getElementById("endOdo").value);
  const endBars = parseInt(document.getElementById("endBars").value);
  if (!tripData || isNaN(endOdo) || isNaN(endBars) || endBars < 0 || endBars > 10) {
    alert("Enter valid ending values");
    return;
  }
  tripData.endOdo = endOdo;
  tripData.endBars = endBars;
  localStorage.setItem("tripData", JSON.stringify(tripData));
  showSummary();
  closeModal("endTripModal");
}

function addFuelEntry() {
  const odo = parseFloat(document.getElementById("fuelOdo").value);
  const liters = parseFloat(document.getElementById("fuelLiters").value);
  const price = parseFloat(document.getElementById("fuelPrice").value);
  if (!tripData || isNaN(odo) || isNaN(liters) || isNaN(price) || odo <= (tripData.fuelEntries.slice(-1)[0]?.odo || tripData.startOdo)) {
    alert("Invalid fuel entry");
    return;
  }
  tripData.fuelEntries.push({ odo, liters, price });
  localStorage.setItem("tripData", JSON.stringify(tripData));
  document.getElementById("fuelOdo").value = "";
  document.getElementById("fuelLiters").value = "";
  document.getElementById("fuelPrice").value = "";
  renderLog();
}

function addMiscEntry() {
  const category = document.getElementById("miscCategory").value;
  const amount = parseFloat(document.getElementById("miscAmount").value);
  if (!tripData || isNaN(amount) || amount <= 0) {
    alert("Invalid misc entry");
    return;
  }
  tripData.miscEntries.push({ category, amount });
  localStorage.setItem("tripData", JSON.stringify(tripData));
  document.getElementById("miscAmount").value = "";
  renderLog();
}

function renderLog() {
  const logList = document.getElementById("logList");
  logList.innerHTML = "";
  if (!tripData) return;
  tripData.fuelEntries.forEach((f, i) => {
    logList.innerHTML += `<li>Fuel: ${f.liters}L @ ₹${f.price}/L (Odo ${f.odo}) <button onclick="deleteEntry('fuel',${i})" class="text-red-500">x</button></li>`;
  });
  tripData.miscEntries.forEach((m, i) => {
    logList.innerHTML += `<li>${m.category}: ₹${m.amount} <button onclick="deleteEntry('misc',${i})" class="text-red-500">x</button></li>`;
  });
}

function deleteEntry(type, index) {
  if (type === "fuel") tripData.fuelEntries.splice(index, 1);
  else tripData.miscEntries.splice(index, 1);
  localStorage.setItem("tripData", JSON.stringify(tripData));
  renderLog();
}

function showSummary() {
  if (!tripData.endOdo || tripData.endOdo <= tripData.startOdo) {
    alert("Invalid odometer readings");
    return;
  }
  const distance = tripData.endOdo - tripData.startOdo;
  const startFuelL = tripData.startBars * 4.5;
  const endFuelL = tripData.endBars * 4.5;
  const fuelPurchased = tripData.fuelEntries.reduce((sum, f) => sum + f.liters, 0);
  const fuelUsed = fuelPurchased + startFuelL - endFuelL;
  const totalFuelCostPurchased = tripData.fuelEntries.reduce((sum, f) => sum + f.liters * f.price, 0);
  const avgFuelPrice = fuelPurchased > 0 ? totalFuelCostPurchased / fuelPurchased : 0;
  const fuelCostBarsDiff = (startFuelL - endFuelL) * avgFuelPrice;
  const totalFuelCost = totalFuelCostPurchased + fuelCostBarsDiff;
  const categories = ["Food", "Parking", "Toll", "Misc", "Accommodation"];
  let miscTotals = {};
  categories.forEach(c => miscTotals[c] = 0);
  tripData.miscEntries.forEach(m => miscTotals[m.category] += m.amount);
  const totalMisc = Object.values(miscTotals).reduce((a,b) => a+b,0);
  const totalExpense = totalFuelCost + totalMisc;
  const fuelEconomy = fuelUsed > 0 ? (distance / fuelUsed) : 0;
  
  let summaryHTML = `<h2 class="text-lg font-bold mb-2">Trip Summary</h2>
  <p>Total Distance: ${distance.toFixed(1)} km</p>
  <p>Total Fuel Used: ${fuelUsed.toFixed(2)} L</p>
  <p>Average Fuel Price: ₹${avgFuelPrice.toFixed(2)}/L</p>
  <p>Fuel Cost: ₹${totalFuelCost.toFixed(2)}</p>
  <h3 class="mt-2 font-semibold">Expenses:</h3>`;
  categories.forEach(c => {
    summaryHTML += `<p>${c}: ₹${miscTotals[c].toFixed(2)}</p>`;
  });
  summaryHTML += `<p class="font-bold">Total Expense: ₹${totalExpense.toFixed(2)}</p>
  <p>Fuel Economy: ${fuelEconomy.toFixed(2)} km/L</p>
  <button onclick="copySummary()" class="mt-2 bg-gray-800 text-white px-3 py-2 rounded">Copy Summary</button>`;
  
  const summaryDiv = document.getElementById("summarySection");
  summaryDiv.innerHTML = summaryHTML;
  summaryDiv.classList.remove("hidden");
}

function copySummary() {
  const text = document.getElementById("summarySection").innerText;
  navigator.clipboard.writeText(text).then(() => alert("Summary copied to clipboard"));
}
</script>
</body>
</html>

