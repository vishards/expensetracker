<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Trip Expense Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">

<!-- Header -->
<h1 class="text-center text-2xl font-bold mb-4">Trip Expense Tracker</h1>

<!-- Top Buttons -->
<div class="flex justify-center gap-4 mb-6">
  <button onclick="openStartTripModal()" class="bg-green-500 text-white px-4 py-2 rounded-lg">Start Trip</button>
  <button onclick="openEndTripModal()" class="bg-red-500 text-white px-4 py-2 rounded-lg">End Trip</button>
</div>

<!-- Section 1: Fuel Entry -->
<div class="bg-white p-4 rounded-lg shadow mb-4">
  <h2 class="font-semibold mb-2">Add Fuel Entry</h2>
  <div class="mb-2">
    <label class="block text-sm">Odometer (km)</label>
    <input type="number" id="fuelOdo" class="w-full border rounded px-2 py-1">
  </div>
  <div class="mb-2">
    <label class="block text-sm">Liters</label>
    <input type="number" id="fuelLiters" class="w-full border rounded px-2 py-1">
  </div>
  <div class="mb-2">
    <label class="block text-sm">₹ / Liter</label>
    <input type="number" id="fuelPrice" class="w-full border rounded px-2 py-1">
  </div>
  <button onclick="addFuelEntry()" class="bg-blue-500 text-white px-3 py-1 rounded">Add Fuel</button>
</div>

<!-- Section 2: Misc Expense -->
<div class="bg-white p-4 rounded-lg shadow mb-4">
  <h2 class="font-semibold mb-2">Add Misc Expense</h2>
  <div class="mb-2">
    <label class="block text-sm">Category</label>
    <select id="miscCategory" class="w-full border rounded px-2 py-1">
      <option value="Food">Food</option>
      <option value="Parking">Parking</option>
      <option value="Toll">Toll</option>
      <option value="Misc">Misc</option>
      <option value="Accommodation">Accommodation</option>
    </select>
  </div>
  <div class="mb-2">
    <label class="block text-sm">Amount (₹)</label>
    <input type="number" id="miscAmount" class="w-full border rounded px-2 py-1">
  </div>
  <button onclick="addMiscEntry()" class="bg-blue-500 text-white px-3 py-1 rounded">Add Expense</button>
</div>

<!-- Log Section -->
<div class="bg-white p-4 rounded-lg shadow mb-4">
  <h2 class="font-semibold mb-2">Log</h2>
  <ul id="logList" class="space-y-1"></ul>
</div>

<!-- Summary Section -->
<div id="summarySection" class="bg-white p-4 rounded-lg shadow hidden">
  <h2 class="font-semibold mb-2">Trip Summary</h2>
  <div id="summaryContent" class="text-sm"></div>
  <button onclick="copySummary()" class="mt-3 bg-gray-700 text-white px-3 py-1 rounded">Copy Summary</button>
</div>

<!-- Start Trip Modal -->
<div id="startTripModal" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center">
  <div class="bg-white p-4 rounded-lg w-80">
    <h3 class="font-semibold mb-2">Start New Trip</h3>
    <label class="block text-sm">Start Odometer (km)</label>
    <input type="number" id="startOdo" class="w-full border rounded px-2 py-1 mb-2">
    <label class="block text-sm">Start Fuel Bars (0-10)</label>
    <input type="number" id="startBars" class="w-full border rounded px-2 py-1 mb-4">
    <div class="flex justify-end gap-2">
      <button onclick="closeStartTripModal()" class="px-3 py-1 border rounded">Cancel</button>
      <button onclick="startTrip()" class="bg-green-500 text-white px-3 py-1 rounded">Save</button>
    </div>
  </div>
</div>

<!-- End Trip Modal -->
<div id="endTripModal" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center">
  <div class="bg-white p-4 rounded-lg w-80">
    <h3 class="font-semibold mb-2">End Trip</h3>
    <label class="block text-sm">End Odometer (km)</label>
    <input type="number" id="endOdo" class="w-full border rounded px-2 py-1 mb-2">
    <label class="block text-sm">End Fuel Bars (0-10)</label>
    <input type="number" id="endBars" class="w-full border rounded px-2 py-1 mb-4">
    <div class="flex justify-end gap-2">
      <button onclick="closeEndTripModal()" class="px-3 py-1 border rounded">Cancel</button>
      <button onclick="endTrip()" class="bg-red-500 text-white px-3 py-1 rounded">Save</button>
    </div>
  </div>
</div>

<script>
let tripData = JSON.parse(localStorage.getItem("tripData")) || {};

function openStartTripModal(){ document.getElementById("startTripModal").classList.remove("hidden"); }
function closeStartTripModal(){ document.getElementById("startTripModal").classList.add("hidden"); }
function openEndTripModal(){ document.getElementById("endTripModal").classList.remove("hidden"); }
function closeEndTripModal(){ document.getElementById("endTripModal").classList.add("hidden"); }

function startTrip(){
  const startOdo = parseFloat(document.getElementById("startOdo").value);
  const startBars = parseInt(document.getElementById("startBars").value);
  if(isNaN(startOdo) || isNaN(startBars) || startBars<0 || startBars>10){ alert("Enter valid data"); return; }
  tripData = { startOdo, startBars, endOdo:null, endBars:null, fuelEntries:[], miscEntries:[] };
  localStorage.setItem("tripData", JSON.stringify(tripData));
  document.getElementById("logList").innerHTML = "";
  document.getElementById("summarySection").classList.add("hidden");
  document.getElementById("summaryContent").innerHTML = "";
  closeStartTripModal();
}

function addFuelEntry(){
  const odo = parseFloat(document.getElementById("fuelOdo").value);
  const liters = parseFloat(document.getElementById("fuelLiters").value);
  const price = parseFloat(document.getElementById("fuelPrice").value);
  if(!tripData.startOdo){ alert("Start trip first"); return; }
  if(isNaN(odo) || isNaN(liters) || isNaN(price) || liters<=0 || price<=0){ alert("Enter valid data"); return; }
  if(tripData.fuelEntries.length && odo <= tripData.fuelEntries.slice(-1)[0].odo){ alert("Odometer must increase"); return; }
  tripData.fuelEntries.push({odo, liters, price});
  localStorage.setItem("tripData", JSON.stringify(tripData));
  document.getElementById("fuelOdo").value = "";
  document.getElementById("fuelLiters").value = "";
  document.getElementById("fuelPrice").value = "";
  renderLog();
}

function addMiscEntry(){
  const cat = document.getElementById("miscCategory").value;
  const amt = parseFloat(document.getElementById("miscAmount").value);
  if(!tripData.startOdo){ alert("Start trip first"); return; }
  if(isNaN(amt) || amt<=0){ alert("Enter valid amount"); return; }
  tripData.miscEntries.push({cat, amt});
  localStorage.setItem("tripData", JSON.stringify(tripData));
  document.getElementById("miscAmount").value = "";
  renderLog();
}

function renderLog(){
  const logList = document.getElementById("logList");
  logList.innerHTML = "";
  tripData.fuelEntries.forEach((f,i)=>{
    const li = document.createElement("li");
    li.textContent = `Fuel: Odo ${f.odo} | ${f.liters} L @ ₹${f.price}`;
    logList.appendChild(li);
  });
  tripData.miscEntries.forEach((m,i)=>{
    const li = document.createElement("li");
    li.textContent = `${m.cat}: ₹${m.amt}`;
    logList.appendChild(li);
  });
}

function endTrip(){
  const endOdo = parseFloat(document.getElementById("endOdo").value);
  const endBars = parseInt(document.getElementById("endBars").value);
  if(isNaN(endOdo) || isNaN(endBars) || endBars<0 || endBars>10){ alert("Enter valid data"); return; }
  tripData.endOdo = endOdo;
  tripData.endBars = endBars;
  localStorage.setItem("tripData", JSON.stringify(tripData));
  closeEndTripModal();
  showSummary();
}

function showSummary(){
  const dist = tripData.endOdo - tripData.startOdo;
  const fuelStart = tripData.startBars * 4.5;
  const fuelEnd = tripData.endBars * 4.5;
  const fuelPurchased = tripData.fuelEntries.reduce((sum,f)=> sum + f.liters, 0);
  const totalFuelUsed = fuelPurchased + fuelStart - fuelEnd;

  const fuelCostPurchased = tripData.fuelEntries.reduce((sum,f)=> sum + (f.liters * f.price), 0);
  const avgFuelPrice = fuelPurchased ? fuelCostPurchased / fuelPurchased : 0;
  const fuelCostBarsDiff = (fuelStart - fuelEnd) * avgFuelPrice;
  const totalFuelCost = fuelCostPurchased + fuelCostBarsDiff;

  const categories = ["Food","Parking","Toll","Misc","Accommodation"];
  const miscTotals = {};
  categories.forEach(c=> miscTotals[c]=0);
  tripData.miscEntries.forEach(m=> miscTotals[m.cat] += m.amt);

  const totalMiscCost = Object.values(miscTotals).reduce((a,b)=>a+b,0);
  const totalExpense = totalFuelCost + totalMiscCost;
  const fuelEconomy = totalFuelUsed > 0 ? (dist / totalFuelUsed).toFixed(2) : 0;

  let summaryHtml = `<p><strong>Total Distance:</strong> ${dist} km</p>`;
  summaryHtml += `<p><strong>Total Fuel Used:</strong> ${totalFuelUsed.toFixed(2)} L</p>`;
  summaryHtml += `<p><strong>Fuel Cost:</strong> ₹${totalFuelCost.toFixed(2)}</p>`;
  summaryHtml += `<p><strong>Expenses:</strong></p><ul class="list-disc pl-5">`;
  categories.forEach(c=> summaryHtml += `<li>${c}: ₹${miscTotals[c].toFixed(2)}</li>`);
  summaryHtml += `</ul>`;
  summaryHtml += `<p><strong>Total Expense:</strong> ₹${totalExpense.toFixed(2)}</p>`;
  summaryHtml += `<p><strong>Fuel Economy:</strong> ${fuelEconomy} km/L</p>`;

  document.getElementById("summaryContent").innerHTML = summaryHtml;
  document.getElementById("summarySection").classList.remove("hidden");
}

function copySummary(){
  const text = document.getElementById("summaryContent").innerText;
  navigator.clipboard.writeText(text).then(()=> alert("Summary copied to clipboard!"));
}

if(tripData.startOdo){ renderLog(); }
</script>
</body>
</html>

