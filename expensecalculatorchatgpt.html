<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trip Expense Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">

  <!-- Header -->
  <h1 class="text-2xl font-bold text-center mb-2">Trip Expense Tracker</h1>
  <div class="flex justify-center gap-4 mb-4">
    <button onclick="openModal('startTripModal')" class="bg-green-600 text-white px-4 py-2 rounded-lg">Start Trip</button>
    <button onclick="openModal('endTripModal')" class="bg-red-600 text-white px-4 py-2 rounded-lg">End Trip</button>
  </div>

  <!-- Section 1: Fuel Entry -->
  <div class="w-full max-w-md bg-white p-4 rounded-xl shadow mb-4">
    <h2 class="font-semibold mb-2">Add Fuel Entry</h2>
    <div class="space-y-2">
      <div class="flex justify-between items-center">
        <label class="w-1/2">Odometer (km):</label>
        <input id="fuelOdo" type="number" class="border rounded p-1 w-1/2">
      </div>
      <div class="flex justify-between items-center">
        <label class="w-1/2">Liters:</label>
        <input id="fuelLiters" type="number" class="border rounded p-1 w-1/2">
      </div>
      <div class="flex justify-between items-center">
        <label class="w-1/2">₹ / Liter:</label>
        <input id="fuelPrice" type="number" class="border rounded p-1 w-1/2">
      </div>
      <button onclick="addFuelEntry()" class="bg-blue-600 text-white w-full py-2 rounded-lg mt-2">Add Fuel</button>
    </div>
  </div>

  <!-- Section 2: Misc Entry -->
  <div class="w-full max-w-md bg-white p-4 rounded-xl shadow mb-4">
    <h2 class="font-semibold mb-2">Add Misc Expense</h2>
    <div class="space-y-2">
      <div class="flex justify-between items-center">
        <label class="w-1/2">Type:</label>
        <select id="miscType" class="border rounded p-1 w-1/2">
          <option>Food</option>
          <option>Parking</option>
          <option>Toll</option>
          <option>Misc</option>
          <option>Accommodation</option>
        </select>
      </div>
      <div class="flex justify-between items-center">
        <label class="w-1/2">Amount (₹):</label>
        <input id="miscAmount" type="number" class="border rounded p-1 w-1/2">
      </div>
      <button onclick="addMiscEntry()" class="bg-purple-600 text-white w-full py-2 rounded-lg mt-2">Add Expense</button>
    </div>
  </div>

  <!-- Log Section -->
  <div id="logSection" class="w-full max-w-md bg-white p-4 rounded-xl shadow mb-4 hidden">
    <h2 class="font-semibold mb-2">Entry Log</h2>
    <ul id="logList" class="space-y-2 text-sm"></ul>
  </div>

  <!-- Summary Section -->
  <div id="summarySection" class="w-full max-w-md bg-white p-4 rounded-xl shadow hidden">
    <h2 class="font-semibold mb-2">Trip Summary</h2>
    <div id="summaryContent" class="text-sm space-y-1"></div>
    <button onclick="copySummary()" class="bg-gray-700 text-white w-full py-2 rounded-lg mt-3">Copy Summary</button>
  </div>

  <!-- Start Trip Modal -->
  <div id="startTripModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center">
    <div class="bg-white p-4 rounded-xl w-80">
      <h2 class="font-bold mb-2">Start New Trip</h2>
      <div class="space-y-2">
        <div class="flex justify-between items-center">
          <label>Odometer (km):</label>
          <input id="startOdo" type="number" class="border rounded p-1 w-1/2">
        </div>
        <div class="flex justify-between items-center">
          <label>Fuel Bars (0-10):</label>
          <input id="startBars" type="number" class="border rounded p-1 w-1/2" min="0" max="10">
        </div>
      </div>
      <div class="flex justify-end gap-2 mt-3">
        <button onclick="closeModal('startTripModal')" class="px-3 py-1 bg-gray-300 rounded">Cancel</button>
        <button onclick="startTrip()" class="px-3 py-1 bg-green-600 text-white rounded">Start</button>
      </div>
    </div>
  </div>

  <!-- End Trip Modal -->
  <div id="endTripModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center">
    <div class="bg-white p-4 rounded-xl w-80">
      <h2 class="font-bold mb-2">End Trip</h2>
      <div class="space-y-2">
        <div class="flex justify-between items-center">
          <label>Odometer (km):</label>
          <input id="endOdo" type="number" class="border rounded p-1 w-1/2">
        </div>
        <div class="flex justify-between items-center">
          <label>Fuel Bars (0-10):</label>
          <input id="endBars" type="number" class="border rounded p-1 w-1/2" min="0" max="10">
        </div>
      </div>
      <div class="flex justify-end gap-2 mt-3">
        <button onclick="closeModal('endTripModal')" class="px-3 py-1 bg-gray-300 rounded">Cancel</button>
        <button onclick="endTrip()" class="px-3 py-1 bg-red-600 text-white rounded">End</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded hidden"></div>

<script>
let tripData = JSON.parse(localStorage.getItem("tripData")) || null;
const FUEL_PER_BAR = 4.5;

function openModal(id){ document.getElementById(id).classList.remove("hidden"); }
function closeModal(id){ document.getElementById(id).classList.add("hidden"); }
function showToast(msg){
  const t=document.getElementById("toast");
  t.innerText=msg; t.classList.remove("hidden");
  setTimeout(()=>t.classList.add("hidden"),2000);
}

function startTrip(){
  const startOdo = parseFloat(document.getElementById("startOdo").value);
  const startBars = parseInt(document.getElementById("startBars").value);
  if(isNaN(startOdo)||isNaN(startBars)||startBars<0||startBars>10){showToast("Enter valid values");return;}

  tripData = {startOdo, startBars, endOdo:null, endBars:null, fuelEntries:[], miscEntries:[]};
  localStorage.setItem("tripData", JSON.stringify(tripData));

  // Log entry
  addLog(`Trip started | Odo: ${startOdo} km | Fuel bars: ${startBars} (${(startBars*FUEL_PER_BAR).toFixed(1)} L)`);

  document.getElementById("summarySection").classList.add("hidden");
  document.getElementById("summaryContent").innerHTML="";
  document.getElementById("logSection").classList.remove("hidden");
  closeModal('startTripModal');
}

function endTrip(){
  if(!tripData){showToast("Start trip first");return;}
  const endOdo=parseFloat(document.getElementById("endOdo").value);
  const endBars=parseInt(document.getElementById("endBars").value);
  if(isNaN(endOdo)||isNaN(endBars)||endBars<0||endBars>10||endOdo<=tripData.startOdo){showToast("Enter valid values");return;}

  tripData.endOdo=endOdo; tripData.endBars=endBars;
  localStorage.setItem("tripData", JSON.stringify(tripData));

  addLog(`Trip ended | Odo: ${endOdo} km | Fuel bars: ${endBars} (${(endBars*FUEL_PER_BAR).toFixed(1)} L)`);

  showSummary();
  closeModal('endTripModal');
}

function addFuelEntry(){
  if(!tripData){showToast("Start trip first");return;}
  const odo=parseFloat(document.getElementById("fuelOdo").value);
  const liters=parseFloat(document.getElementById("fuelLiters").value);
  const price=parseFloat(document.getElementById("fuelPrice").value);
  if(isNaN(odo)||isNaN(liters)||isNaN(price)||odo<=tripData.startOdo){showToast("Enter valid values");return;}

  const entry={odo, liters, price, cost:liters*price};
  tripData.fuelEntries.push(entry);
  localStorage.setItem("tripData", JSON.stringify(tripData));

  addLog(`Fuel | Odo: ${odo} km | ${liters} L @ ₹${price}/L = ₹${entry.cost.toFixed(0)}`);

  document.getElementById("fuelOdo").value="";
  document.getElementById("fuelLiters").value="";
  document.getElementById("fuelPrice").value="";
}

function addMiscEntry(){
  if(!tripData){showToast("Start trip first");return;}
  const type=document.getElementById("miscType").value;
  const amt=parseFloat(document.getElementById("miscAmount").value);
  if(isNaN(amt)||amt<=0){showToast("Enter valid amount");return;}

  tripData.miscEntries.push({type, amt});
  localStorage.setItem("tripData", JSON.stringify(tripData));

  addLog(`${type} expense: ₹${amt.toFixed(0)}`);
  document.getElementById("miscAmount").value="";
}

function addLog(text){
  document.getElementById("logSection").classList.remove("hidden");
  const li=document.createElement("li");
  li.textContent=text;
  document.getElementById("logList").appendChild(li);
}

function showSummary(){
  let dist=tripData.endOdo-tripData.startOdo;
  let startLit=tripData.startBars*FUEL_PER_BAR;
  let endLit=tripData.endBars*FUEL_PER_BAR;
  let fuelUsed=startLit+tripData.fuelEntries.reduce((s,e)=>s+e.liters,0)-endLit;
  let fuelCost=tripData.fuelEntries.reduce((s,e)=>s+e.cost,0);
  let miscTotals={Food:0,Parking:0,Toll:0,Misc:0,Accommodation:0};
  tripData.miscEntries.forEach(e=>{miscTotals[e.type]+=e.amt;});
  let miscTotal=Object.values(miscTotals).reduce((a,b)=>a+b,0);
  let total=fuelCost+miscTotal;

  let html=`<p><b>Distance:</b> ${dist} km</p>
            <p><b>Fuel Used:</b> ${fuelUsed.toFixed(1)} L</p>
            <p><b>Fuel Cost:</b> ₹${fuelCost.toFixed(0)}</p>`;
  for(const [k,v] of Object.entries(miscTotals)){ if(v>0) html+=`<p><b>${k}:</b> ₹${v.toFixed(0)}</p>`; }
  html+=`<p><b>Total Expense:</b> ₹${total.toFixed(0)}</p>`;
  if(fuelUsed>0) html+=`<p><b>Fuel Economy:</b> ${(dist/fuelUsed).toFixed(1)} km/L</p>`;
  document.getElementById("summaryContent").innerHTML=html;
  document.getElementById("summarySection").classList.remove("hidden");
}

function copySummary(){
  let text=document.getElementById("summaryContent").innerText;
  navigator.clipboard.writeText(text);
  showToast("Summary copied!");
}
</script>
</body>
</html>

